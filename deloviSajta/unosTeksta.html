<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Unos teksta</title>
    <script type="text/javascript" src="../js/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="unosTeksta.css"/>
    <link href="../css/reset.css" />
</head>
<body>
    <div id="wrapper">
        <div id="left">
            <div id="top-left">
                <span class="textStyle">bold</span>
                <span class="textStyle">italic</span>
                <span style="width: 2px; border-right: 1px solid black;"></span><br />
                <span class="img">image</span>
                <input type="file" id="uploadFile" />
                <input type="button" id="upload" value="Otpremi" />

            </div>
            <textarea id="text"></textarea>
        </div>
        <div id="right">

        </div>
        <script type="text/javascript">
            $(document).ready(function () {
                //Klik za stil
                $(".textStyle").on("click", function () {
                   var $textarea = $("#text");
                   var start = $textarea.prop("selectionStart");
                   var end = $textarea.prop("selectionEnd");
                   text = $textarea.val();
                   if(start == end) {
                       var current = $textarea.prop("selectionStart");
                       var textBefore = text.substring(0, current);
                       var textAfter = text.substring(current, text.length);
                       var addText = "<span class=\"" + $(this).text() + "\"></span>";
                       $textarea.val(textBefore + addText + textAfter);
                   }
                   else {
                       var selected = text.substring(start, end);
                       textBefore = text.substring(0, start);
                       textAfter = text.substring(end, text.length);
                       addText = "<span class=\"" + $(this).text() + "\">" + selected + "</span>";
                       $textarea.val(textBefore + addText + textAfter);
                   }
                });

                //Klik za sliku
                var img_src;
                $(".img").on("click", function () {
                    var $textarea = $("#text");
                    var start = $textarea.prop("selectionStart");
                    var end = $textarea.prop("selectionEnd");
                    text = $textarea.val();
                    if(start == end) {
                        var current = $textarea.prop("selectionStart");
                        var textBefore = text.substring(0, current);
                        var textAfter = text.substring(current, text.length);
                        var addText = "<img src=\"" + img_src + "\"></img>";
                        $textarea.val(textBefore + addText + textAfter);
                    }
                    else {
                        var selected = text.substring(start, end);
                        textBefore = text.substring(0, start);
                        textAfter = text.substring(end, text.length);
                        addText = "<img src=\"" + img_src + "\">" + selected + "</span>";
                        $textarea.val(textBefore + addText + textAfter);
                    }
                });

                $("#text").on("keyup", function () {
                    $("#right").html($(this).val());
                });

                $("#right").css({top: $("#top-left").height() + 4, left: "20px"});

                $("#upload").on("click", function () {
                    var $uploadFile = $("#uploadFile")
                    img_src = $uploadFile.val();
                    $.post("uploadFile.php", {"file" : $uploadFile.val(), "submit" : "submited"}, function (data) {
                        alert(data);
                    });
                })
            });
        </script>
    </div>
</body>
</html>
